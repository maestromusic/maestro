#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Copyright 2010 Martin Altmayer
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 3 as
# published by the Free Software Foundation
#
import os, sys, getopt
from omg import application, constants

if __name__=="__main__":
    if os.path.dirname(__file__):
        os.chdir(os.path.dirname(__file__))
        # And then one directory above
        os.chdir("../")
    pop = False
    opts, args = getopt.getopt(sys.argv[1:],
        "pVv:",
        ['populate','version','loglevel='])
    for opt,arg in opts:
        if opt in ('-V', '--version'):
            print('This is OMG version {}. Nice to meet you.'.format(constants.VERSION))
            sys.exit(0)
        elif opt in ('-v', '--loglevel'):
            application.optionsOverride['log'] = {'consoleLogLevel': arg}
        elif opt in ('-p', '--populate'):
            pop = True
    if pop:
        from omg import config
        config.init(application.optionsOverride)
        from omg import database
        database.connect()
        from omg import tags
        tags.updateIndexedTags()
        import omg.gopulate
        if args:
            popdirs = args
        else:
            popdirs = [ config.get('music','collection') ]
        omg.gopulate.run(popdirs)
    else:
        application.run()